<!doctype html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>数据模型设计指南 - LeanCloud 文档</title>
<!-- build:js custom/js/docs-all.js -->
<script src="custom/js/lib/jquery.min.js"></script>
<script src="custom/js/lib/bootstrap.min.js"></script>
<script src="custom/js/lib/bootstrap-hover-dropdown.js"></script>
<script src="custom/js/lib/pretty/prettify.js"></script>
<script src="custom/js/lib/jquery.scrollTo.min.js"></script>
<script src="custom/js/lib/angular/angular.min.js"></script>
<script src="custom/js/lib/zeroclipboard/zeroclipboard.js"></script>
<script src="custom/js/lib/markdown.min.js"></script>
<script src="custom/js/lib/md5.js"></script>

<script src="custom/js/lib/angular-gravatar.js"></script>
<script src="custom/js/prepare-dom.js"></script>
<script src="custom/js/app.js"></script>
<script src="custom/js/common.js"></script>
<script src="custom/js/demo.js"></script>
<script src="custom/js/weapp-domains.js"></script>
<!-- endbuild -->

<script type="text/javascript">
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', 'a268202b003f2516']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
  </script>

<link rel="stylesheet" type="text/css" href="custom/css/app-docs.css?githubv1">


</head>


<body class="dashboard-init" data-offset="0" ng-cloak="" ng-controller="AppCtrl">




  <nav class="dashboard-subnav navbar navbar-default navbar-static-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#app-options" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand nav-logo font-logo" title="LeanCloud 官网">LeanCloud</a>
    </div>

    <div class="collapse navbar-collapse" id="app-options">
      <!-- <ul class="nav navbar-nav navbar-app-select">
        <li>
          <a href="/dashboard/applist.html" class="nav-logo font-logo" title="LeanCloud 控制台">LeanCloud</a>
        </li>
      </ul> -->
      <div class="navbar-app-actions-wrap">
        <ul class="nav navbar-nav navbar-app-actions">
          
          <li class="dropdown dropdown-toggle-app-name">
            <a href="index.html">
              <i class="icon icon-dashbd-icon icon-home"></i>
              <div class="name">文档首页</div>
            </a>
          </li>
          
          <li class="dropdown dropdown-toggle-app-name">
            <a href="sdk_down.html" title="SDK 下载">
              <i class="icon icon-dashbd-icon icon-package"></i>
              <div class="name"><span class="mobile-hide">SDK </span>下载</div>
            </a>
          </li>
          <li class="dropdown dropdown-toggle-app-name">
            <a href="demo.html" title="Demos">
              <i class="icon icon-dashbd-icon icon-magic"></i>
              <div class="name">Demos</div>
            </a>
          </li>
          <li class="dropdown dropdown-toggle-app-name">
            <a class="nav-key-6 dropdown-toggle" title="API Docs" data-toggle="dropdown">
              <i class="icon icon-dashbd-icon icon-log"></i>
              <div class="name">API 文档</div>
            </a>
            <ul class="dropdown-menu">
            <li><a href="/api-docs/android/index.html" target="_blank">Android SDK API</a></li>
<li><a href="/api-docs/iOS/index.html" target="_blank">Objective-C SDK API</a></li>
<li><a href="https://leancloud.github.io/javascript-sdk/docs/" target="_blank">JavaScript 数据存储 SDK API</a></li>
<li><a href="https://leancloud.github.io/js-realtime-sdk/docs/" target="_blank">JavaScript 实时通信 SDK API</a></li>
<li><a href="https://leancloud.readthedocs.io/">Python SDK API</a></li>
<li><a href="/api-docs/php/" target="_blank">PHP SDK API</a></li>
<li><a href="/api-docs/dotnet/Help/index.html">.NET SDK API</a></li>

            </ul>
          </li>
          
          <li class="dropdown dropdown-toggle-app-name">
            <a href="opencourse.html">
              <i class="icon icon-dashbd-icon icon-play"></i>
              <div class="name">公开课</div>
            </a>
          </li>
          
          <li class="dropdown dropdown-toggle-app-name">
            <a class="nav-key-6 dropdown-toggle" title="帮助" data-toggle="dropdown">
              <i class="icon icon-dashbd-icon icon-question"></i>
              <div class="name">帮助</div>
            </a>
            <ul class="dropdown-menu">
              <li><a href="https://leanticket.cn/t/leancloud">技术支持</a></li>
              <li><a href="http://forum.leancloud.cn">社区</a></li>
              <li><a href="http://blog.leancloud.cn/">Blog</a></li>
              <li role="presentation" class="divider"></li>
              <li><a href="/dashboard/apionline/index.html">在线 API 工具</a></li>
              <li role="presentation" class="divider"></li>
              <!-- <li><a href="/apps.html">LeanCloud App</a></li> -->
              <li><a href="/pricing">价格</a></li>
              <!-- <li><a href="#" data-toggle="modal" data-target="#modal-shortcuts">快捷键</a></li> -->
            </ul>
          </li>
        </ul>
        <!-- hide search input on the home page -->
        
          <form role="search" action="/search.html" method="get">
            <div class="app-search">
              <input name="q" type="text" class="form-control" placeholder="搜索文档&hellip;">
            </div>
          </form>
        
      </div>

      <ul class="nav navbar-nav navbar-user-actions navbar-right" ng-cloak="">

        <li class="dropdown" ng-show="user.username">
          <a role="button" class="dropdown-toggle user-name" data-toggle="dropdown">
            <span class="user-gravatar">
              <img gravatar-src="user.email" gravatar-size="64">
            </span>
            <span class="user-name-text">{{user.username}}</span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="/settings.html">账号设置</a></li>
            <li><a href="/applist.html">控制台</a></li>
            
            <li><a href="/settings.html#/setting/team">团队管理</a></li>
            
            <li><a href="/bill.html#/bill/general">财务</a></li>
            <!-- <li><a href="settings.html#/setting/invite">邀请好友</a></li> -->
            <li ng-show="user.username" style=""><a ng-click="signout()">登出</a></li>
          </ul>
        </li>
        <li ng-hide="user.username">
          <a href="/login.html#/signin">登录</a>
        </li>
        <li ng-hide="user.username">
          <a href="/login.html#/signup">注册</a>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div>
  <!-- .container-fluid -->
</nav>



<header class="doc-subnav" role="banner">
  <div class="container-fluid">
    <nav class="" role="navigation">
      <ul class="nav navbar-nav">
        
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">功能概览</a>
          <ul class="dropdown-menu">
            <li><a href="storage_overview.html">数据存储服务总览</a></li>
            <li><a href="leanengine_overview.html">云引擎总览</a></li>
            <li><a href="push_guide.html">消息推送服务总览</a></li>
            <li><a href="realtime_v2.html">实时通信服务总览</a></li>
            <li><a href="dashboard_guide.html">控制台使用指南</a></li>
            <li><a href="data_security.html">数据安全</a></li>
            <li><a href="error_code.html">错误码详解</a></li>
            <li><a href="faq.html">常见问题</a></li>
            <li><a href="tool_tips.html">常见功能提示</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">Objective-C</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-objc.html">SDK 安装指南</a></li>
            <li><a href="leanstorage-started-objc.html">数据存储快速入门</a></li>
            <li><a href="leanstorage_guide-objc.html">数据存储开发指南</a></li>
            <li><a href="livequery-guide.html">LiveQuery 开发指南</a></li>
            <li><a href="ios_push_guide.html">消息推送开发指南</a></li>
            <li><a href="ios_push_cert.html">iOS 推送证书设置指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="realtime_guide-objc.html">实时通信开发指南</a></li>
            <li><a href="chatkit-ios.html">ChatKit 使用指南</a></li>
            <li><a href="livekit-ios.html">LiveKit 使用指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="relation-guide.html">数据模型设计指南</a></li>
            <li><a href="acl-guide.html">ACL 权限管理指南</a></li>
            <li><a href="ios_statistics.html">统计分析开发指南</a></li>
            
            <li><a href="sms-guide.html">短信服务使用指南</a></li>
            
            <li><a href="ios_crashreporting_guide.html">崩溃报告使用指南</a></li>
            <li><a href="ios-macos-faq.html">FAQ</a></li>
            <li><a href="/api-docs/iOS/index.html" target="_blank">SDK API</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">Swift</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-swift.html">SDK 安装指南</a></li>
            <li><a href="leanstorage_guide-swift.html">数据存储开发指南</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">Android</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-android.html">SDK 安装指南</a></li>
            <li><a href="leanstorage-started-android.html">数据存储快速入门</a></li>
            <li><a href="leanstorage_guide-android.html">数据存储开发指南</a></li>
            <li><a href="livequery-guide.html">LiveQuery 开发指南</a></li>
            <li><a href="android_push_guide.html">消息推送开发指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="realtime_guide-android.html">实时通信开发指南</a></li>
            <li><a href="chatkit-android.html">ChatKit 使用指南</a></li>
            <li><a href="livekit-android.html">LiveKit 使用指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="relation-guide.html">数据模型设计指南</a></li>
            <li><a href="acl-guide.html">ACL 权限管理指南</a></li>
            <li><a href="android_statistics.html">统计分析开发指南</a></li>
            
            <li><a href="sms-guide.html">短信服务使用指南</a></li>
            
            <li><a href="android_faq.html">FAQ</a></li>
            <li><a href="/api-docs/android/index.html" target="_blank">SDK API</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">JavaScript</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-js.html">SDK 安装指南</a></li>
            <li><a href="leanstorage-started-js.html">数据存储快速入门</a></li>
            <li><a href="leanstorage_guide-js.html">数据存储开发指南</a></li>
            <li><a href="livequery-guide.html">LiveQuery 开发指南</a></li>
            <li><a href="weapp.html">微信小程序开发指南</a></li>
            <li><a href="leanstorage_guide-js.html#Push_通知">消息推送开发指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="realtime_guide-js.html">实时通信开发指南</a></li>
            <li><a href="relation-guide.html">数据模型设计指南</a></li>
            <li><a href="acl-guide.html">ACL 权限管理指南</a></li>
            
            <li><a href="sms-guide.html">短信服务使用指南</a></li>
            
            <li><a href="js_analytics.html">统计分析开发指南</a></li>
            <!-- <li><a href="js_faq.html">FAQ</a></li> -->
            <li role="separator" class="divider"></li>
            <li><a href="https://leancloud.github.io/javascript-sdk/docs/" target="_blank">数据存储 SDK API</a></li>
            <li><a href="https://leancloud.github.io/js-realtime-sdk/docs/" target="_blank">实时通信 SDK API</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">云引擎</li>
            <li><a href="leanengine_webhosting_guide-node.html">网站托管开发指南</a></li>
            <li><a href="leanengine_cloudfunction_guide-node.html">云函数开发指南</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">.NET / Unity3D</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-dotnet.html">.NET SDK 安装指南</a></li>
            <li><a href="dotnet_guide.html">.NET 数据存储开发指南</a></li>
            <li><a href="livequery-guide.html">LiveQuery 开发指南</a></li>
            <li><a href="analytics-guide.html">.NET 统计开发指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="unity_guide.html">Unity3D 数据存储开发指南</a></li>
            <li><a href="realtime-unity.html">Unity3D 实时通信开发指南</a></li>
            <li><a href="analytics-guide.html">Unity3D 统计开发指南</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="dotnet_push_guide.html">WP8.0 消息推送开发指南</a></li>
            <li role="separator" class="divider"></li>
            <!-- <li><a href="dotnet_faq.html">FAQ</a></li> -->
            <li><a href="/api-docs/dotnet/Help/index.html" target="_blank">.NET SDK API</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">Python</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-python.html">SDK 安装指南</a></li>
            <li><a href="leanstorage_guide-python.html">数据存储开发指南</a></li>
            <li><a href="relation-guide.html">数据模型设计指南</a></li>
            <li><a href="im-servermgmt-guide-python.html">实时通讯服务端管理开发指南</a></li>
            <li><a href="https://leancloud.readthedocs.io/" target="_blank">SDK API</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">云引擎</li>
            <li><a href="leanengine_webhosting_guide-python.html">网站托管开发指南</a></li>
            <li><a href="leanengine_cloudfunction_guide-python.html">云函数开发指南</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">PHP</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-php.html">SDK 安装指南</a></li>
            <li><a href="leanstorage_guide-php.html">数据存储开发指南</a></li>
            <li><a href="/api-docs/php/" target="_blank">SDK API</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">云引擎</li>
            <li><a href="leanengine_webhosting_guide-php.html">网站托管开发指南</a></li>
            <li><a href="leanengine_cloudfunction_guide-php.html">云函数开发指南</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">Java</a>
          <ul class="dropdown-menu">
            <li><a href="sdk_setup-java.html">SDK 安装指南</a></li>
            <li><a href="leanstorage_guide-java.html">数据存储开发指南</a></li>
            <li><a href="sms-guide.html">短信 SMS 服务使用指南</a></li>
            <li class="dropdown-header">云引擎</li>
            <li><a href="leanengine_webhosting_guide-java.html">网站托管开发指南</a></li>
            <li><a href="leanengine_cloudfunction_guide-java.html">云函数开发指南</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">REST API</a>
          <ul class="dropdown-menu">
            <li><a href="rest_api.html">数据存储 API</a></li>
            <li><a href="leanengine-rest-api.html">云引擎 API</a></li>
            <li><a href="rest_api.html#Push_通知">消息推送 API</a></li>
            <li><a href="realtime_rest_api.html">实时通信 API</a></li>
            
            <li><a href="rest_sms_api.html">短信验证 API</a></li>
            
            <li><a href="rest_api.html#统计数据_API">数据统计 API</a></li>
            <li><a href="status_system.html#REST_API">应用内社交 API</a></li>
            <li><a href="app_search_guide.html#搜索_API">应用内搜索 API</a></li>
            <li><a href="cql_guide.html">CQL 查询语言详解</a></li>
            <!--<li><a href="oauth2_provider.html">开放平台接入</a></li>-->
            <!-- <li><a href="rest_faq.html">FAQ</a></li> -->
          </ul>
        </li>

        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">云引擎</a>
          <ul class="dropdown-menu">
          <li><a href="leanengine_overview.html">云引擎总览</a></li>
          <li><a href="leanengine_quickstart.html">云引擎快速入门</a></li>
          <li><a href="leanengine_plan.html">云引擎运行方案</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Node.js</li>
          <li><a href="leanengine_webhosting_guide-node.html">网站托管开发指南</a></li>
          <li><a href="leanengine_cloudfunction_guide-node.html">云函数开发指南</a></li>
          <li class="dropdown-header">Python</li>
          <li><a href="leanengine_webhosting_guide-python.html">网站托管开发指南</a></li>
          <li><a href="leanengine_cloudfunction_guide-python.html">云函数开发指南</a></li>
          <li class="dropdown-header">PHP</li>
          <li><a href="leanengine_webhosting_guide-php.html">网站托管开发指南</a></li>
          <li><a href="leanengine_cloudfunction_guide-php.html">云函数开发指南</a></li>
          <li class="dropdown-header">Java</li>
          <li><a href="leanengine_webhosting_guide-java.html">网站托管开发指南</a></li>
          <li><a href="leanengine_cloudfunction_guide-java.html">云函数开发指南</a></li>
          <li role="separator" class="divider"></li>
          <li><a href="leanengine_examples.html">云引擎项目示例</a></li>
          <li><a href="leanengine_cli.html">命令行工具 CLI</a></li>
          <li><a href="acl_guide_leanengine.html">在云引擎中管理 ACL</a></li>
          <li><a href="push-guide-leanengine.html">在云引擎中使用 Push 推送服务</a></li>
          <li><a href="leanengine_faq.html">FAQ</a></li>
          <li><a href="leancache_guide.html">LeanCache 使用指南</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-hover="dropdown" href="#">更多</a>
          <ul class="dropdown-menu">
            
            <li><a href="status_system.html">应用内社交使用指南</a></li>
            <li><a href="sns.html">第三方平台账号登录 SNS 开发指南</a></li>
            <li><a href="feedback.html">用户反馈开发指南</a></li>
            
            <li><a href="app_search_guide.html">应用内搜索和 DeepLink 开发指南</a></li>
            <li><a href="app_data_share.html">应用之间数据共享（Class 绑定）</a></li>
            <!-- <li><a href="user_groups.html">用户群分析指南</a></li> -->
            
            <li><a href="leaninsight_guide.html">离线数据分析使用指南</a></li>
            
            <li class="divider"></li>
            <li><a href="kb-network-connectivity-diagnosis.html">网络连通性诊断流程</a></li>
            <li class="divider"></li>
            <li><a href="tutorials.html">教程</a></li>
           <li><a href="demo.html">Demo</a></li>
          </ul>
        </li>
      </ul>
      <!-- <ul class="nav navbar-nav navbar-right">
        <li>
          <form action="/search.html" method="get" target="_blank" class="search-form">
            <input name="q" class="search-input" placeholder="搜索&hellip;">
          </form>
        </li>
      </ul> -->
    </nav>
  </div>
</header>


<div class="container-fluid">

  <div class="row">

    <div class="sidebar-gruntfile-trigger  col-sm-3" id="left-nav">

      <div class="sidebar-affix-shadow sidebar-hover-off">

        <div class="sidebar-wrapper" id="toc-wrapper">

        </div>
        <!-- .sidebar-wrapper -->

      </div>
      <!-- .sidebar-affix-shadow -->

    </div>
    <!-- .col-md-3 -->

    <div class="col-sm-9 sidebar-gruntfile-trigger">
      <div class="doc-content with-comment" id="content">
        <div class="docs-meta">
          <span class="icon icon-github"></span><a href="https://github.com/leancloud/docs#贡献">编辑文档</a>
        <span class="doc-mdate" data-toggle="tooltip" title="2017年9月26日下午2点53分">更新于 <time datetime="2017-09-26T14:53:09+08:00">2017-09-26</time></span></div>
        <h1 id="-">数据模型设计指南</h1>
<p>多年以来，关系型数据库已经成为了企业数据管理的基础，很多工程师对于关系模型和 6 个范式都比较了解，但是如今来构建和运行一个应用，随着数据来源的越发多样和用户量的不断增长，关系数据库的限制逐渐成为业务的瓶颈，因此越来越多的公司开始向其它 NoSQL 数据库进行迁移。</p>
<p>LeanCloud 的存储后台大量采用了 MongoDB 这种文档数据库来存储结构化数据，正因如此我们才能提供面向对象的、海量的、无需创建数据表结构即存即用的存储能力。从传统的关系型数据库转换到 LeanCloud 或者 MongoDB 存储系统，最基础的改变就是「数据建模 Schema 设计」。</p>
<p>首先来梳理一下关系型数据库、MongoDB 和 LeanCloud 的对应术语：</p>
<table>
<thead>
<tr>
<th>RDBMS</th>
<th>MongoDB</th>
<th>LeanCloud         </th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td>Database</td>
<td>Application       </td>
</tr>
<tr>
<td>Table</td>
<td>Collection</td>
<td>Class             </td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
<td>Object            </td>
</tr>
<tr>
<td>Index</td>
<td>Index</td>
<td>Index             </td>
</tr>
<tr>
<td>JOIN</td>
<td>Embedded，Reference</td>
<td>Embedded Object, Pointer</td>
</tr>
</tbody>
</table>
<p>在 LeanCloud 上进行数据建模设计需要数据架构师、开发人员和 DBA 在观念上做一些转变：之前是传统的关系型数据模型，所有数据都会被映射到二维的表结构「行」和「列」；现在是丰富、动态的对象模型，即 MongoDB 的「文档模型」，包括内嵌子对象和数组。</p>
<h2 id="-">文档模型</h2>
  <div class="callout callout-info">
  <p>后文中我们有时候采用 LeanCloud 的核心概念 <strong>Object（对象）</strong>，有时候提到 MongoDB 中的名词 <strong>Document（文档）</strong>，它们是等同的。</p>
</div>


<p>我们现在使用的大部分数据都有比较复杂的结构，用「JSON 对象」来建模比用「表」会更加高效。通过内嵌子对象和数组，JSON 对象可以和应用层的数据结构完全对齐。这对开发者来说，会更容易将应用层的数据映射到数据库里的对象。相反，将应用层的数据映射到关系数据库的表，则会降低开发效率。而比较普遍的增加额外的对象关系映射（ORM）层的做法，也同时降低了 schema 扩展和查询优化的灵活性，引入了新的复杂度。</p>
<p>例如，在 RDBMS 中有父子关系的两张表，通常就会变成 LeanCloud 里面含有内嵌子对象的单文档结构。以下图的数据为例：</p>
<p><strong>PERSON 表</strong></p>
<table>
<thead>
<tr>
<th>Pers_ID</th>
<th>Surname</th>
<th>First_Name</th>
<th>City </th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>柳</td>
<td>红</td>
<td>伦敦    </td>
</tr>
<tr>
<td>1</td>
<td>杨</td>
<td>真</td>
<td>北京     </td>
</tr>
<tr>
<td>2</td>
<td>王</td>
<td>新</td>
<td>苏黎世    </td>
</tr>
</tbody>
</table>
<p><strong>CAR 表</strong></p>
<table>
<thead>
<tr>
<th>Car_ID</th>
<th>Model</th>
<th>Year</th>
<th>Value</th>
<th>Pers_ID </th>
</tr>
</thead>
<tbody>
<tr>
<td>101</td>
<td>大众迈腾</td>
<td>2015</td>
<td>180000</td>
<td>0        </td>
</tr>
<tr>
<td>102</td>
<td>丰田汉兰达</td>
<td>2016</td>
<td>240000</td>
<td>0   </td>
</tr>
<tr>
<td>103</td>
<td>福特翼虎</td>
<td>2014</td>
<td>220000</td>
<td>1  </td>
</tr>
<tr>
<td>104</td>
<td>现代索纳塔</td>
<td>2013</td>
<td>150000</td>
<td>2   </td>
</tr>
</tbody>
</table>
<p>RDBMS 中通过 Pers_ID 域来连接 PERSON 表和 CAR 表，以此支持应用中显示每辆车的拥有者信息。使用文档模型，通过内嵌子对象和数组可以将相关数据提前合并到一个单一的数据结构中，传统的跨表的行和列现在都被存储到了一个文档内，完全省略掉了 join 操作。</p>
<p>换成 LeanCloud 来对同样的数据建模，则允许我们创建这样的 schema：一个单一的 Person 对象，里面通过一个子对象数组来保存该用户所拥有的每一部 Car，例如：</p>
<pre><code class="lang-json">{
  &quot;first_name&quot;:&quot;红&quot;,
  &quot;surname&quot;:&quot;柳&quot;,
  &quot;city&quot;:&quot;伦敦&quot;,
  &quot;location&quot;:[
    45.123,
    47.232
  ],
  &quot;cars&quot;:[
    {
      &quot;model&quot;:&quot;大众迈腾&quot;,
      &quot;year&quot;:2015,
      &quot;value&quot;:180000
    },
    {
      &quot;model&quot;:&quot;丰田汉兰达&quot;,
      &quot;year&quot;:2016,
      &quot;value&quot;:240000
    }
  ]
}
</code></pre>
<p>文档数据库里的一篇文档，就相当于 LeanCloud 平台里的一个对象。这个例子里的关系模型虽然只由两张表组成（现实中大部分应用可能需要几十、几百甚至上千张表），但是它并不影响我们思考数据的方式。</p>
<p>为了更好地展示关系模型和文档模型的区别，我们用一个博客平台来举例。从下图中可以看出，依赖 RDBMS 的应用需要 join 五张不同的表来获得一篇博客的完整数据，而在 LeanCloud 中所有的博客数据都包含在一个文档中，博客作者和评论者的用户信息则通过一个到 User 的引用（指针）进行关联。</p>
<p><img src="images/rdbm-vs-mongodb.png" alt=""></p>
<h2 id="-">文档模型的优点</h2>
<p>除了数据表现更加自然之外，文档模型还有性能和扩展性方面的优势：</p>
<ul>
<li>通过单一调用即可获得完整的文档，避免了多表 join 的开销。LeanCloud 的 Object 物理上作为一个单一的块进行存储，只需要一次内存或者磁盘的读操作即可。RDBMS 与此相反，一个 join 操作需要从不同地方多次读取操作才可完成。</li>
<li>文档是自包含的，将数据库内容分布到多个节点（也叫 Sharding）会更简单，同时也更容易通过普通硬件的水平扩展获得更高性能。DBA 们不再需要担心跨节点进行 join 操作可能带来的性能恶化问题。</li>
</ul>
<h2 id="-schema">定义文档 Schema</h2>
<p>应用的数据访问模式决定了 schema 设计，因此我们需要特别明确以下几点：</p>
<ul>
<li>数据库读写操作的比例以及是否需要重点优化某一方的性能；</li>
<li>对数据库进行查询和更新的操作类型；</li>
<li>数据生命周期和文档的增长率；</li>
</ul>
<p>以此来设计更合适的 schema 结构。</p>
<p>对于普通的「属性名:值」来说，设计比较简单，和 RDBMS 中平坦的表结构差别不大。对于一对一或 一对多的关系会很自然地考虑使用内嵌对象：</p>
<ul>
<li>数据「所有」和「包含」的关系，都可以通过内嵌对象来进行建模。</li>
<li>同时，在架构上也可以把那些经常需要同时、原子改动的属性作为一个对象嵌入到一个单独的属性中。</li>
</ul>
<p>例如，为了记录每个学生的家庭住址，我们可以把住址信息作为一个整体嵌入 Student 类里面。</p>
<pre><code class="lang-objc">    AVObject *studentTom = [[AVObject alloc] initWithClassName:@&quot;Student&quot;];// 学生 Tom
    [studentTom setObject:@&quot;Tom&quot; forKey:@&quot;name&quot;];
    NSDictionary *addr = [NSDictionary dictionaryWithObjectsAndKeys:
                          @&quot;北京&quot;, @&quot;city&quot;,
                          @&quot;西城区西长安街 1 号&quot;, @&quot;address&quot;,
                          @&quot;100017&quot;, @&quot;postcode&quot;,
                          nil];
    [studentTom setObject:addr forKey:@&quot;address&quot;];
    [studentTom saveInBackground];// 保存到云端
</code></pre>
<pre><code class="lang-java">    final AVObject studentTom = new AVObject(&quot;Student&quot;);// 学生 Tom
    studentTom.put(&quot;name&quot;, &quot;Tom&quot;);
    HashMap&lt;Object, Object&gt; addr = new HashMap&lt;&gt;();
    addr.put(&quot;city&quot;, &quot;北京&quot;);
    addr.put(&quot;address&quot;, &quot;西城区西长安街 1 号&quot;);
    addr.put(&quot;postcode&quot;, &quot;100017&quot;);
    studentTom.put(&quot;address&quot;, addr);
    studentTom.saveInBackground();
</code></pre>
<pre><code class="lang-js">    // 学生 Tom
    var studentTom = new AV.Object(&#39;Student&#39;);
    studentTom.set(&#39;name&#39;, &#39;Tom&#39;);
    var addr = { &quot;city&quot;: &quot;北京&quot;, &quot;address&quot;: &quot;西城区西长安街 1 号&quot;, &quot;postcode&quot;:&quot;100017&quot; };
    studentTom.set(&#39;address&#39;, addr);
    studentTom.save();
</code></pre>
<pre><code class="lang-python">    import leancloud

    student_tom = leancloud.Object.extend(&quot;Student&quot;)()
    student_tom.set(&#39;name&#39;, &#39;Tom&#39;)

    addr = { &quot;city&quot;: &quot;北京&quot;, &quot;address&quot;: &quot;西城区西长安街 1 号&quot;, &quot;&quot;:&quot;100017&quot; };
    student_tom.set(&#39;address&#39;, addr)

    # 保存在云端
    student_tom.save()
</code></pre>
<pre><code class="lang-cs">    var studentTom = new AVObject(&quot;Student&quot;);
    studentTom[&quot;name&quot;] = &quot;Tom&quot;;
    var addr = new Dictionary&lt;string, object&gt;();
    addr[&quot;city&quot;] = &quot;北京&quot;;
    addr[&quot;address&quot;] = &quot;西城区西长安街 1 号&quot;;
    addr[&quot;postcode&quot;] = &quot;100017&quot;;
    studentTom[&quot;address&quot;] = addr;
    studentTom.SaveAsync();
</code></pre>
<p>但并不是所有的一对一关系都适合内嵌的方式，对下面的情况后文介绍的「引用」（等同于 MongoDB 的 reference）方式会更加合适：</p>
<ul>
<li>一个对象被频繁地读取，但是内嵌的子对象却很少会被访问。</li>
<li>对象的一部分属性频繁地被更新，数据大小持续增长，但是剩下的一部分属性基本稳定不变。</li>
<li>对象大小超过了 LeanCloud 当前最大 16 MB 限制。</li>
</ul>
<p>接下来我们重点讨论一下在 LeanCloud 上如何通过「引用」机制来实现复杂的关系模型。</p>
<p>数据对象之间存在 3 种类型的关系：「一对一」将一个对象与另一个对象关联，「一对多」是一个对象关联多个对象，「多对多」则用来实现大量对象之间的复杂关系。</p>
<p>我们支持 4 种方式来构建对象之间的关系，这些都是通过 MongoDB 的文档引用来实现的：</p>
<ol>
<li>Pointers（适合一对一、一对多关系）</li>
<li>中间表（多对多）</li>
<li><del>Arrays（一对多、多对多)</del> 不建议使用，请参考 <a href="#何时使用数组">何时使用数组</a>。</li>
</ol>
<h2 id="-">一对多关系</h2>
<h3 id="pointers-">Pointers 存储</h3>
<p>中国的「省份」与「城市」具有典型的一对多的关系。深圳和广州（城市）都属于广东省（省份），而朝阳区和海淀区（行政区）只能属于北京市（直辖市）。广东省对应着多个一级行政城市，北京对应着多个行政区。下面我们使用 Pointers 来存储这种一对多的关系。</p>
<blockquote>
<p>为了表述方便，后文中提及城市都泛指一级行政市以及直辖市行政区，而省份也包含了北京、上海等直辖市。</p>
</blockquote>
<pre><code class="lang-objc">    AVObject *GuangZhou = [[AVObject alloc] initWithClassName:@&quot;City&quot;];// 广州
    [GuangZhou setObject:@&quot;广州&quot; forKey:@&quot;name&quot;];

    AVObject *GuangDong = [[AVObject alloc] initWithClassName:@&quot;Province&quot;];// 广东
    [GuangDong setObject:@&quot;广东&quot; forKey:@&quot;name&quot;];

    [GuangZhou setObject:GuangDong forKey:@&quot;dependent&quot;];// 为广州设置 dependent 属性为广东

    [GuangZhou saveInBackgroundWithBlock:^(BOOL succeeded, NSError *error) {
        if (succeeded) {
          // 广州被保存成功  
        }
    }];
    // 广东无需被单独保存，因为在保存广州的时候已经上传到云端。
</code></pre>
<pre><code class="lang-java">    AVObject guangZhou = new AVObject(&quot;City&quot;);// 广州
    guangZhou.put(&quot;name&quot;, &quot;广州&quot;);

    AVObject guangDong = new AVObject(&quot;Province&quot;);// 广东
    guangDong.put(&quot;name&quot;, &quot;广东&quot;);

    guangZhou.put(&quot;dependent&quot;, guangDong);// 为广州设置 dependent 属性为广东

    guangZhou.saveInBackground(new SaveCallback() {
        @Override
        public void done(AVException e) {
            if (e == null) {
                // 广州被保存成功
            }
        }
    });
    // 广东无需被单独保存，因为在保存广州的时候已经上传到云端。
</code></pre>
<pre><code class="lang-js">    // 新建一个 AV.Object
    var GuangZhou = new AV.Object(&#39;City&#39;);// 广州
    GuangZhou.set(&#39;name&#39;, &#39;广州&#39;);
    var GuangDong = new AV.Object(&#39;Province&#39;);// 广东
    GuangDong.set(&#39;name&#39;, &#39;广东&#39;);
    GuangZhou.set(&#39;dependent&#39;, GuangDong);// 为广州设置 dependent 属性为广东
    GuangZhou.save().then(function (guangZhou) {
        console.log(guangZhou.id);
    });
    // 广东无需被单独保存，因为在保存广州的时候已经上传到云端。
</code></pre>
<pre><code class="lang-python">    import leancloud

    guangZhou = leancloud.Object.extend(&#39;City&#39;)()
    guangZhou.set(&#39;name&#39;, &#39;广州&#39;)

    guangDong = leancloud.Object.extend(&#39;Province&#39;)()
    guangDong.set(&#39;name&#39;, &#39;广东&#39;)

    # 为广州设置 dependent 属性为广东
    guangZhou.set(&#39;dependent&#39;, guangDong)

    # 广东无需被单独保存，因为在保存广州的时候已经上传到服务端。
    guangZhou.save()
</code></pre>
<pre><code class="lang-cs">    var guangZhou = new AVObject(&quot;City&quot;);// 广州
    guangZhou[&quot;name&quot;] = &quot;广州&quot;;

    var guangDong = new AVObject(&quot;Province&quot;);// 广东
    guangDong[&quot;name&quot;] = &quot;广东&quot;;

    guangZhou[&quot;dependent&quot;] = guangDong;// 为广州设置 dependent 属性为广东

    guangZhou.SaveAsync();// 广东无需被单独保存，因为在保存广州的时候已经上传到服务端。
</code></pre>
<p>注意：保存关联对象的同时，被关联的对象也会随之被保存到云端。</p>
<p>要关联一个已经存在于云端的对象，例如将「东莞市」添加至「广东省」，方法如下：</p>
<pre><code class="lang-objc">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    AVObject *GuangDong = [AVObject objectWithoutDataWithClassName:@&quot;Province&quot; objectId:@&quot;56545c5b00b09f857a603632&quot;];    
    AVObject *DongGuan = [[AVObject alloc] initWithClassName:@&quot;City&quot;];// 东莞
    [DongGuan setObject:@&quot;东莞&quot; forKey:@&quot;name&quot;];

    [DongGuan setObject:GuangDong forKey:@&quot;dependent&quot;];// 为东莞设置 dependent 属性为广东
</code></pre>
<pre><code class="lang-java">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    AVObject guangDong = AVObject.createWithoutData(&quot;Province&quot;, &quot;56545c5b00b09f857a603632&quot;);
    AVObject dongGuan = new AVObject(&quot;City&quot;);// 东莞
    dongGuan.put(&quot;name&quot;, &quot;东莞&quot;);

    dongGuan.put(&quot;dependent&quot;, guangDong);// 为东莞设置 dependent 属性为广东
</code></pre>
<pre><code class="lang-js">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    var GuangDong = AV.Object.createWithoutData(&#39;Province&#39;, &#39;56545c5b00b09f857a603632&#39;);
    var DongGuan = new AV.Object(&#39;City&#39;);
    DongGuan.set(&#39;name&#39;, &#39;东莞&#39;);
    DongGuan.set(&#39;dependent&#39;, GuangDong);
    DongGuan.save();
</code></pre>
<pre><code class="lang-python">    import leancloud

    # 用 create_without_data 关联一个已经存在的对象
    Province = leancloud.Object.extend(&#39;Province&#39;)
    guangDong = Province.create_without_data(&#39;574416af79bc44005c61bfa3&#39;)

    dongGuan = leancloud.Object.extend(&#39;City&#39;)()
    dongGuan.set(&#39;name&#39;, &#39;东莞&#39;)
    # 为东莞设置 dependent 属性为广东
    dongGuan.set(&#39;dependent&#39;, guangDong)

    dongGuan.save()
</code></pre>
<pre><code class="lang-cs">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    AVObject guangDong = AVObject.CreateWithoutData(&quot;Province&quot;, &quot;56545c5b00b09f857a603632&quot;);
    AVObject dongGuan = new AVObject(&quot;City&quot;);// 东莞
    dongGuan[&quot;name&quot;] = &quot;东莞&quot;;

    dongGuan[&quot;dependent&quot;] = guangDong;// 为东莞设置 dependent 属性为广东
</code></pre>
<p>执行上述代码后，在应用控制台可以看到 <code>dependent</code> 字段显示为 Pointer 数据类型，而它本质上存储的是一个指向 <code>Province</code> 这张表的某个 AVObject 的指针。</p>
<h3 id="pointers-">Pointers 查询</h3>
<p>假如已知一个城市，想知道它的上一级的省份：</p>
<pre><code class="lang-objc">    // 假设东莞作为 City 对象存储的时候它的 objectId 是 568e743c00b09aa22162b11f，这个  objectId 可以在控制台查看
    AVObject *DongGuan = [AVObject objectWithoutDataWithClassName:@&quot;City&quot; objectId:@&quot;568e743c00b09aa22162b11f&quot;];
    NSArray *keys = [NSArray arrayWithObjects:@&quot;dependent&quot;, nil];
    [DongGuan fetchInBackgroundWithKeys:keys block:^(AVObject *object, NSError *error) {
         // 获取广东省
         AVObject *province = [object objectForKey:@&quot;dependent&quot;];
    }];
</code></pre>
<pre><code class="lang-java">    // 假设东莞作为 City 对象存储的时候它的 objectId 是 568e743c00b09aa22162b11f，这个 objectId 可以在控制台查看
    AVObject dongGuan = AVObject.createWithoutData(&quot;City&quot;, &quot;568e743c00b09aa22162b11f&quot;);
    dongGuan.fetchInBackground(&quot;dependent&quot;, new GetCallback&lt;AVObject&gt;() {
        @Override
        public void done(AVObject avObject, AVException e) {
            // 获取广东省
            AVObject province = avObject.getAVObject(&quot;dependent&quot;);
        }
    });
</code></pre>
<pre><code class="lang-js">    // 假设东莞作为 City 对象存储的时候它的 objectId 是 568e743c00b09aa22162b11f，这个  objectId 可以在控制台查看
    var DongGuan = AV.Object.createWithoutData(&#39;City&#39;, &#39;568e743c00b09aa22162b11f&#39;);
    DongGuan.fetch({ include: [&#39;dependent&#39;] }).then(function (city) {
        var province = city.get(&#39;dependent&#39;);
        console.log(province.get(&#39;name&#39;));
    });
</code></pre>
<pre><code class="lang-python">    import leancloud

    City = leancloud.Object.extend(&#39;City&#39;)
    guangZhou = City.create_without_data(&#39;5744189fdf0eea0063ad948b&#39;)
    guangZhou.fetch()
    province_id = guangZhou.get(&#39;dependent&#39;).id  # 获取广东省的 objectId

    province = leancloud.Object.extend(&#39;Province&#39;)()
    province.id = province_id
    province.fetch()  # 根据 objectId 获取 province
</code></pre>
<pre><code class="lang-cs">    AVObject guangDong = AVObject.CreateWithoutData(&quot;Province&quot;, &quot;56545c5b00b09f857a603632&quot;);
    guangDong.FetchAsync(new string[] { &quot;dependent&quot; }).ContinueWith(t =&gt;
    {
        var province = guangDong.Get&lt;AVObject&gt;(&quot;dependent&quot;);
        var name = province[&quot;name&quot;];
    });
</code></pre>
<p>假如查询结果中包含了城市，并想通过一次查询同时把对应的省份也一并加载到本地：</p>
<pre><code class="lang-objc">    AVQuery *query = [AVQuery queryWithClassName:@&quot;City&quot;];

    // 查询名字是广州的城市
    [query whereKey:@&quot;name&quot; equalTo:@&quot;广州&quot;];

    // 找出对应城市的省份
    [query includeKey:@&quot;dependent&quot;];

    [query findObjectsInBackgroundWithBlock:^(NSArray *cities, NSError *error) {
        // cities 的结果为 name 等于广州的城市的集合，当然我们知道现实中只存在一个广州市
        for (AVObject *city in cities) {
            // 并不需要网络访问
            // 获取对应的省份
            AVObject *province = [city objectForKey:@&quot;dependent&quot;];
        }
    }];
</code></pre>
<pre><code class="lang-java">    AVQuery&lt;AVObject&gt; query = new AVQuery&lt;&gt;(&quot;City&quot;);

    // 查询名字是广州的城市
    query.whereEqualTo(&quot;name&quot;, &quot;广州&quot;);

    // 找出对应城市的省份
    query.include(&quot;dependent&quot;);

    query.findInBackground(new FindCallback&lt;AVObject&gt;() {
        @Override
        public void done(List&lt;AVObject&gt; list, AVException e) {
            // list 的结果为 name 等于广州的城市的集合，当然我们知道现实中只存在一个广州市
            for (AVObject city : list) {
                // 并不需要网络访问
                // 获取对应的省份
                AVObject province = city.getAVObject(&quot;dependent&quot;);
            }
        }
    });
</code></pre>
<pre><code class="lang-js">    var query = new AV.Query(&#39;City&#39;);
    query.equalTo(&#39;name&#39;, &#39;广州&#39;);
    query.include([&#39;dependent&#39;]);
    query.find().then(function (result) {
        if (result.length &gt; 0) {
            var GuangZhou = result[0];
            var province = GuangZhou.get(&#39;dependent&#39;);
        }
    });
</code></pre>
<pre><code class="lang-python">    import leancloud

    query = leancloud.Query(&quot;City&quot;)
    query.equal_to(&#39;name&#39;, &#39;广州&#39;)
    query.include(&#39;dependent&#39;)  # 关键代码，找出对应城市的省份

    for city in query.find():
        province = city.get(&#39;dependent&#39;)
        province_name = province.get(&#39;name&#39;)
        # 可以获取 province 的信息
</code></pre>
<pre><code class="lang-cs">    var query = new AVQuery&lt;AVObject&gt;(&quot;City&quot;);
    // 查询名字是广州的城市
    query = query.WhereEqualTo(&quot;name&quot;, &quot;广州&quot;);
    // 告知云端还要一并获取对应城市的省份
    query = query.Include(&quot;dependent&quot;);
    query.FindAsync().ContinueWith(t =&gt;
    {
        // list 的结果为 name 等于广州的城市的集合，当然我们知道现实中只存在一个广州市
        var list = t.Result.ToList();
        list.ForEach((city) =&gt;
        {
            // 并不需要网络访问
            // 获取对应的省份
            var province = city.Get&lt;AVObject&gt;(&quot;dependent&quot;);
            // 获取省份的名字
            var name = province[&quot;name&quot;];
        });
    });
</code></pre>
<p>假如已知一个省份，要找出它的所有下辖城市：</p>
<pre><code class="lang-objc">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    AVObject *GuangDong = [AVObject objectWithoutDataWithClassName:@&quot;Province&quot; objectId:@&quot;56545c5b00b09f857a603632&quot;];

    AVQuery *query = [AVQuery queryWithClassName:@&quot;City&quot;];

    [query whereKey:@&quot;dependent&quot; equalTo:GuangDong];

    [query findObjectsInBackgroundWithBlock:^(NSArray *cities, NSError *error) {
        for (AVObject *city in cities) {
             // cities 的结果为广东省下辖的所有城市
        }
    }];
</code></pre>
<pre><code class="lang-java">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    AVObject guangDong = AVObject.createWithoutData(&quot;Province&quot;, &quot;56545c5b00b09f857a603632&quot;);

    AVQuery&lt;AVObject&gt; query = new AVQuery&lt;&gt;(&quot;City&quot;);

    query.whereEqualTo(&quot;dependent&quot;, guangDong);

    query.findInBackground(new FindCallback&lt;AVObject&gt;() {
        @Override
        public void done(List&lt;AVObject&gt; list, AVException e) {
            for (AVObject city : list) {
                // list 的结果为广东省下辖的所有城市
            }
        }
    });
</code></pre>
<pre><code class="lang-js">    // 假设 GuangDong 的 objectId 为 56545c5b00b09f857a603632
    var GuangDong = AV.Object.createWithoutData(&#39;Province&#39;, &#39;56545c5b00b09f857a603632&#39;);
    var query = new AV.Query(&#39;City&#39;);
    query.equalTo(&#39;dependent&#39;, GuangDong);
    query.find().then(function (cities) {
        cities.forEach(function (city, i, a) {
            console.log(city.id);
        });
    });
</code></pre>
<pre><code class="lang-python">    import leancloud

    Province = leancloud.Object.extend(&#39;Province&#39;)
    guangDong = Province.create_without_data(&#39;574416af79bc44005c61bfa3&#39;)

    query = leancloud.Query(&quot;City&quot;)
    query.equal_to(&#39;dependent&#39;, guangDong)

    for city in query.find():
        city_name = city.get(&#39;name&#39;)
        # 结果为广东省下辖的所有城市
</code></pre>
<pre><code class="lang-cs">    var guangdong = AVObject.CreateWithoutData(&quot;Province&quot;, &quot;56545c5b00b09f857a603632&quot;);
    var query = new AVQuery&lt;AVObject&gt;(&quot;City&quot;);
    query = query.WhereEqualTo(&quot;dependent&quot;, guangdong);
    query.FindAsync().ContinueWith(t =&gt; 
    {
        // list 为广东省下辖的所有城市
        var list = t.Result.ToList();
        list.ForEach((city) =&gt; 
        {
            var name = city.Get&lt;string&gt;(&quot;name&quot;);
        });
    });
</code></pre>
<p>大多数场景下，Pointers 是实现一对多关系的最好选择。</p>
<h2 id="-">多对多关系</h2>
<p>假设有选课应用，我们需要为 <code>Student</code> 对象和 <code>Course</code> 对象建模。一个学生可以选多门课程，一个课程也有多个学生，这是一个典型的多对多关系。我们必须使用 Arrays 或创建自己的中间表来实现这种关系。决策的关键在于<strong>是否需要为这个关系附加一些属性</strong>。</p>
<p>如果不需要附加属性，使用 Arrays 最为简单。通常情况下，使用 Arrays 可以使用更少的查询并获得更好的性能。</p>
  <div class="callout callout-info">
  <p>如果多对多关系中任何一方对象数量可能达到或超过 100，使用中间表是更好的选择。</p>
</div>


<p>反之，若需要为关系附加一些属性，就创建一个独立的表（中间表）来存储两端的关系。记住，附加的属性是描述这个关系的，不是描述关系中的任何一方。所附加的属性可以是：</p>
<ul>
<li>关系创建的时间</li>
<li>关系创建者</li>
<li>某人查看此关系的次数</li>
</ul>
<h3 id="-">使用中间表实现多对多关系（推荐）</h3>
<p>有时我们需要知道更多关系的附加信息，比如在一个学生选课系统中，我们要了解学生打算选修的这门课的课时有多长，或者学生选修是通过手机选修还是通过网站操作的，此时我们可以使用传统的数据模型设计方法「中间表」。</p>
<p>为此，我们创建一个独立的表 <code>StudentCourseMap</code> 来保存 <code>Student</code> 和 <code>Course</code> 的关系：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>course</code></td>
<td>Pointer</td>
<td>Course 指针实例</td>
</tr>
<tr>
<td><code>student</code></td>
<td>Pointer</td>
<td>Student 指针实例</td>
</tr>
<tr>
<td><code>duration</code></td>
<td>Array</td>
<td>所选课程的开始和结束时间点，如 <code>[&quot;2016-02-19&quot;,&quot;2016-04-21&quot;]</code>。</td>
</tr>
<tr>
<td><code>platform</code></td>
<td>String</td>
<td>操作时使用的设备，如 <code>iOS</code>。</td>
</tr>
</tbody>
</table>
<p>如此，实现选修功能的代码如下：</p>
<pre><code class="lang-objc">    AVObject *studentTom = [[AVObject alloc] initWithClassName:@&quot;Student&quot;];// 学生 Tom
    [studentTom setObject:@&quot;Tom&quot; forKey:@&quot;name&quot;];

    AVObject *courseLinearAlgebra = [[AVObject alloc] initWithClassName:@&quot;Course&quot;];
    [courseLinearAlgebra setObject:@&quot;线性代数&quot; forKey:@&quot;name&quot;];

    AVObject *studentCourseMapTom= [[AVObject alloc] initWithClassName:@&quot;StudentCourseMap&quot;];// 选课表对象

    // 设置关联
    [studentCourseMapTom setObject:studentTom forKey:@&quot;student&quot;];
    [studentCourseMapTom setObject:courseLinearAlgebra forKey:@&quot;course&quot;];

    // 设置学习周期
    [studentCourseMapTom setObject: [NSArray arrayWithObjects:@&quot;2016-02-19&quot;,@&quot;2016-04-21&quot;,nil] forKey:@&quot;duration&quot;];
    // 获取操作平台
    [studentCourseMapTom setObject: @&quot;iOS&quot; forKey:@&quot;platform&quot;];

    // 保存选课表对象
    [studentCourseMapTom saveInBackground];
</code></pre>
<pre><code class="lang-java">    AVObject studentTom = new AVObject(&quot;Student&quot;);// 学生 Tom
    studentTom.put(&quot;name&quot;, &quot;Tom&quot;);

    AVObject courseLinearAlgebra = new AVObject(&quot;Course&quot;);
    courseLinearAlgebra.put(&quot;name&quot;, &quot;线性代数&quot;);

    AVObject studentCourseMapTom = new AVObject(&quot;StudentCourseMap&quot;);// 选课表对象

    // 设置关联
    studentCourseMapTom.put(&quot;student&quot;, studentTom);
    studentCourseMapTom.put(&quot;course&quot;, courseLinearAlgebra);

    // 设置学习周期
    studentCourseMapTom.put(&quot;duration&quot;, Arrays.asList(&quot;2016-02-19&quot;, &quot;2016-04-21&quot;));
    // 获取操作平台
    studentCourseMapTom.put(&quot;platform&quot;, &quot;iOS&quot;);

    // 保存选课表对象
    studentCourseMapTom.saveInBackground();
</code></pre>
<pre><code class="lang-js">    var studentTom = new AV.Object(&#39;Student&#39;);
    studentTom.set(&#39;name&#39;, &#39;Tom&#39;);// 学生 Tom

    var courseLinearAlgebra = new AV.Object(&#39;Course&#39;);
    courseLinearAlgebra.set(&#39;name&#39;, &#39;线性代数&#39;);

    // 选课表对象
    var studentCourseMapTom = new AV.Object(&#39;StudentCourseMap&#39;);

    // 设置关联
    studentCourseMapTom.set(&#39;student&#39;, studentTom);
    studentCourseMapTom.set(&#39;course&#39;, courseLinearAlgebra);

    // 设置学习周期
    studentCourseMapTom.set(&#39;duration&#39;, [new Date(2015, 2, 19), new Date(2015, 4, 21)]);

    // 设置操作平台
    studentCourseMapTom.set(&#39;platform&#39;, &#39;web&#39;);

    // 保存选课表对象
    studentCourseMapTom.save();
</code></pre>
<pre><code class="lang-python">    import leancloud

    student_tom = leancloud.Object.extend(&#39;Student&#39;)()
    student_tom.set(&#39;name&#39;, &#39;Tom&#39;)

    course_linear_algebra = leancloud.Object.extend(&#39;Course&#39;)()
    course_linear_algebra.set(&#39;name&#39;, &#39;线性代数&#39;)
    # 选课表对象
    student_course_map_tom = leancloud.Object.extend(&#39;Student_course_map&#39;)()

    # 设置关联
    student_course_map_tom.set(&#39;student&#39;, student_tom)
    student_course_map_tom.set(&#39;course&#39;, course_linear_algebra)

    # 设置学习周期
    student_course_map_tom.set(&#39;duration&#39;, [&quot;2016-02-19&quot;, &quot;2016-04-12&quot;])

    # 获取操作平台
    student_course_map_tom.set(&#39;platform&#39;, &#39;ios&#39;)

    # 保存选课表对象
    student_course_map_tom.save()
</code></pre>
<pre><code class="lang-cs">    AVObject studentTom = new AVObject(&quot;Student&quot;);// 学生 Tom
    studentTom.Add(&quot;name&quot;, &quot;Tom&quot;);

    AVObject courseLinearAlgebra = new AVObject(&quot;Course&quot;);
    courseLinearAlgebra.Add(&quot;name&quot;, &quot;线性代数&quot;);

    AVObject studentCourseMapTom = new AVObject(&quot;StudentCourseMap&quot;);// 选课表对象

    // 设置关联
    studentCourseMapTom.Add(&quot;student&quot;, studentTom);
    studentCourseMapTom.Add(&quot;course&quot;, courseLinearAlgebra);

    // 设置学习周期
    studentCourseMapTom.Add(&quot;duration&quot;, new string[] { &quot;2016-02-19&quot;, &quot;2016-04-21&quot; });
    // 获取操作平台
    studentCourseMapTom.Add(&quot;platform&quot;, &quot;iOS&quot;);

    // 保存选课表对象
    studentCourseMapTom.SaveAsync();
</code></pre>
<p>查询选修了某一课程的所有学生：</p>
<pre><code class="lang-objc">    // 微积分课程
    AVObject *courseCalculus = [AVObject objectWithoutDataWithClassName:@&quot;Course&quot; objectId:@&quot;562da3fdddb2084a8a576d49&quot;];

    // 构建 StudentCourseMap 的查询
    AVQuery *query = [AVQuery queryWithClassName:@&quot;StudentCourseMap&quot;];

    // 查询所有选择了线性代数的学生
    [query whereKey:@&quot;course&quot; equalTo:courseCalculus];

    // 执行查询
    [query findObjectsInBackgroundWithBlock:^(NSArray *studentCourseMaps, NSError *error) {
        // studentCourseMaps 是所有 course 等于线性代数的选课对象
        // 然后遍历过程中可以访问每一个选课对象的 student,course,duration,platform 等属性
        for (AVObject *studentCourseMap in studentCourseMaps) {
            AVObject *student =[studentCourseMap objectForKey:@&quot;student&quot;];
            AVObject *course =[studentCourseMap objectForKey:@&quot;course&quot;];
            NSArray *duration = [studentCourseMap objectForKey:@&quot;duration&quot;];
            NSLog(@&quot;platform: %@&quot;, [studentCourseMap objectForKey:@&quot;platform&quot;]);
        }
    }];
</code></pre>
<pre><code class="lang-java">    // 微积分课程
    AVObject courseCalculus = AVObject.createWithoutData(&quot;Course&quot;, &quot;562da3fdddb2084a8a576d49&quot;);

    // 构建 StudentCourseMap 的查询
    AVQuery&lt;AVObject&gt; query = new AVQuery&lt;&gt;(&quot;StudentCourseMap&quot;);

    // 查询所有选择了线性代数的学生
    query.whereEqualTo(&quot;course&quot;, courseCalculus);

    // 执行查询
    query.findInBackground(new FindCallback&lt;AVObject&gt;() {
        @Override
        public void done(List&lt;AVObject&gt; list, AVException e) {
            // list 是所有 course 等于线性代数的选课对象
            // 然后遍历过程中可以访问每一个选课对象的 student,course,duration,platform 等属性
            for (AVObject studentCourseMap : list) {
                AVObject student = studentCourseMap.getAVObject(&quot;student&quot;);
                AVObject course = studentCourseMap.getAVObject(&quot;course&quot;);
                ArrayList duration = (ArrayList) studentCourseMap.getList(&quot;duration&quot;);
                String platform = studentCourseMap.getString(&quot;platform&quot;);
            }
        }
    });
</code></pre>
<pre><code class="lang-js">    // 微积分课程
    var courseLinearAlgebra = AV.Object.createWithoutData(&#39;Course&#39;, &#39;562da3fdddb2084a8a576d49&#39;);

    // 构建 StudentCourseMap 的查询
    var query = new AV.Query(&#39;StudentCourseMap&#39;);

    // 查询所有选择了线性代数的学生
    query.equalTo(&#39;course&#39;, courseLinearAlgebra);

    // 执行查询
    query.find().then(function (studentCourseMaps) {
        // studentCourseMaps 是所有 course 等于线性代数的选课对象
        // 然后遍历过程中可以访问每一个选课对象的 student,course,duration,platform 等属性
        studentCourseMaps.forEach(function (scm, i, a) {
            var student = scm.get(&#39;student&#39;);
            var duration = scm.get(&#39;duration&#39;);
            var platform = scm.get(&#39;platform&#39;);
        });
    });
</code></pre>
<pre><code class="lang-python">    import leancloud

    Course = leancloud.Object.extend(&#39;Course&#39;)
    course_calculus = Course.create_without_data(&#39;57448184c26a38006b8d4761&#39;)
    query = leancloud.Query(&#39;Student_course_map&#39;)
    query.equal_to(&#39;course&#39;, course_calculus)

    # 查询所有选择了线性代数的学生
    student_course_map_list = query.find()

    # list 是所有 course 等于线性代数的选课对象,
    # 然后遍历过程中可以访问每一个选课对象的 student,course,duration,platform 等属性
    for student_course_map in student_course_map_list:
        student = student_course_map.get(&#39;student&#39;)
        course  = student_course_map.get(&#39;course&#39;)
        duration = student_course_map.get(&#39;duration&#39;)
        platform = student_course_map.get(&#39;platform&#39;)
</code></pre>
<pre><code class="lang-cs">    // 微积分课程
    AVObject courseCalculus = AVObject.CreateWithoutData(&quot;Course&quot;, &quot;562da3fdddb2084a8a576d49&quot;);

    // 构建 StudentCourseMap 的查询
    AVQuery&lt;AVObject&gt; query = new AVQuery&lt;AVObject&gt;(&quot;StudentCourseMap&quot;);

    // 查询所有选择了线性代数的学生
    query.WhereEqualTo(&quot;course&quot;, courseCalculus);

    // 执行查询
    query.FindAsync().ContinueWith(t =&gt;
    {
        var list = t.Result.ToList();
        // 然后遍历过程中可以访问每一个选课对象的 student,course,duration,platform 等属性
        foreach (var studentCourseMap in list)
        {
            AVObject student = studentCourseMap.Get&lt;AVObject&gt;(&quot;student&quot;);
            AVObject course = studentCourseMap.Get&lt;AVObject&gt;(&quot;course&quot;);
            List&lt;string&gt; duration = studentCourseMap.Get&lt;List&lt;string&gt;&gt;(&quot;duration&quot;);
            string platform = studentCourseMap.Get&lt;string&gt;(&quot;platform&quot;);
        }
    });
</code></pre>
<p>同样我们也可以很简单地查询某一个学生选修的所有课程，只需将上述代码变换查询条件即可：</p>
<pre><code class="lang-objc">    AVQuery *query = [AVQuery queryWithClassName:@&quot;StudentCourseMap&quot;];
    AVObject *studentTom = [AVObject objectWithoutDataWithClassName:@&quot;Student&quot; objectId:@&quot;562da3fc00b0bf37b117c250&quot;];
    [query whereKey:@&quot;student&quot; equalTo:studentTom];
</code></pre>
<pre><code class="lang-java">    AVQuery&lt;AVObject&gt; query = new AVQuery&lt;&gt;(&quot;StudentCourseMap&quot;);
    AVObject studentTom = AVObject.createWithoutData(&quot;Student&quot;, &quot;562da3fc00b0bf37b117c250&quot;);
    query.whereEqualTo(&quot;student&quot;, studentTom);
</code></pre>
<pre><code class="lang-js">    var studentTom = AV.Object.createWithoutData(&#39;Student&#39;, &#39;579f0441128fe10054420d49&#39;);
    var query = new AV.Query(&#39;StudentCourseMap&#39;);
    query.equalTo(&#39;student&#39;, studentTom);
</code></pre>
<pre><code class="lang-python">    Student = leancloud.Object.extend(&#39;Student&#39;)
    student_tom = Student.create_without_data(&quot;562da3fc00b0bf37b117c250&quot;)
    query.whereEqualTo(&quot;student&quot;, student_tom)
</code></pre>
<pre><code class="lang-cs">    AVQuery&lt;AVObject&gt; query = new AVQuery&lt;AVObject&gt;(&quot;StudentCourseMap&quot;);
    AVObject studentTom = AVObject.CreateWithoutData(&quot;Student&quot;, &quot;562da3fc00b0bf37b117c250&quot;);
    query.WhereEqualTo(&quot;student&quot;, studentTom);
</code></pre>
<h2 id="-">一对一关系</h2>
<p>当你需要将一个对象拆分成两个对象时，一对一关系是一种重要的需求。这种需求应该很少见，但是在下面的实例中体现了这样的需求：</p>
<ul>
<li><strong>限制部分用户数据的权限</strong><br>
在这个场景中，你可以将此对象拆分成两部分，一部分包含所有用户可见的数据，另一部分包含所有仅自己可见的数据（通过 <a href="data_security.html#Class_级别的_ACL">ACL 控制</a> ）。同样你也可以实现一部分包含所有用户可修改的数据，另一部分包含所有仅自己可修改的数据。</li>
<li><strong>避免大对象</strong><br>
原始对象大小超过了对象的 128 KB 的上限值，此时你可以创建另一个对象来存储额外的数据。当然通常的作法是更好地设计和优化数据模型来避免出现大对象，但如果确实无法避免，则可以考虑使用 AVFile 存储大数据。</li>
<li><strong>更灵活的文件对象</strong><br>
AVFile 可以方便地存取文件，但对对象进行查询和修改等操作就不是很方便了。此时可以使用 AVObject 构造一个自己的文件对象并与 AVFile 建立一对一关联，将文件属性存于 AVObject 中，这样既可以方便查询修改文件属性，也可以方便存取文件。</li>
</ul>
<h2 id="-">关联数据的删除</h2>
<p>当表中有一个 Pointer 指向的源数据被删除时，这个源数据对应的 Pointer <strong>不会</strong>被自动删除。所以建议用户在删除源数据时自行检查是否有 Pointer 指向这条数据，基于业务场景有必要做数据清理的话，可以调用对应的对象上的删除接口将 Pointer 关联的对象删除。</p>
<h2 id="-">索引</h2>
<p>在任何一个数据库系统中，索引都是优化性能的重要手段，同时它与 Schema 设计也是密不可分的。LeanCloud 也支持索引，其索引与关系数据库中基本相同。在索引的选择上，应用查询操作的模式和频率起决定性作用。</p>
<p>同时也要注意，索引不是没有代价的。在加速查询的同时，它也会降低写入速度、消耗更多存储（磁盘和内存）资源。是否建索引，如何建索引，建多少索引，我们需要综合权衡后来下决定。</p>
<h3 id="-">索引类型</h3>
<p>LeanCloud 的索引可以包含任意的属性（包括数组），下面是一些索引选项：</p>
<ul>
<li><p><strong>复合索引</strong><br>在多个属性域上构建一个单独的索引结构。例如，以一个存储客户数据的应用为例，我们可能需要根据姓、名和居住地来查询客户信息。通过在「姓、名、居住地」上建立复合索引，LeanCloud 可以快速给出满足这三个条件的结果。此外，这一复合索引也能加速任何前置属性的查询。例如根据「姓」或者根据「姓＋名」的查询都会使用到这个复合索引。</p>
<div class="callout callout-danger">
<p>注意，如果单按照「名」来查询，此复合索引会失效。</p>
</div>
</li>
<li><p><strong>唯一索引</strong><br>通过给索引加上唯一性约束，LeanCloud 就会拒绝含有相同索引值的对象插入和更新。所有的索引默认都不是唯一索引，如果把复合索引指定为唯一索引，那么应用层必须保证索引列的组合值是唯一的。</p>
</li>
<li><strong>数组索引</strong><br>对数组属性也能创建索引。</li>
<li><strong>地理空间索引</strong><br>LeanCloud 会自动为 GeoPoint 类型的属性建立地理空间索引，但是要求一个 Object 内 GeoPoint 的属性不能超过一个。</li>
<li><strong>稀疏索引</strong><br>这种索引只包含那些含有指定属性的文档，如果文档不含有目标属性，那么就不会进入索引。稀疏索引体积更小，查询性能更高。LeanCloud 默认都会创建稀疏索引。</li>
</ul>
<p>LeanCloud 的索引可以在任何域上建立，包括内嵌对象和数组类型，这使它带来了比 RDBMS 更强大的功能。</p>
<h3 id="-">通过索引优化性能</h3>
<p>LeanCloud 后台会根据每天的访问日志，自动归纳和学习频繁使用的访问模式，并自动创建合适的索引。不过如果你对索引优化比较有经验，也可以在控制台为每一个 Class 手动创建索引。</p>
<h2 id="-schema">持续优化 Schema</h2>
<p>在 LeanCloud 的存储系统里，Class 可以在没有完整的结构定义（包含哪些属性、数据类型如何等）时就提前创建好，一个 Class 下的对象（Object）也无需包含所有属性域，我们可以随时往对象中增减新的属性。</p>
<p>这种灵活、动态的 Schema 机制，使 Schema 的持续优化变得非常简单。相比之下，关系数据库的开发人员和 DBA 在开始一个新项目的时候，写下第一行代码之前，就需要制定好数据库 Schema，这至少需要几天，有的需要数周甚至更长。而 LeanCloud 则允许开发者通过不断迭代和敏捷过程，持续优化 Schema。开发者可以开始写代码并将他们创建的对象持久化存储起来，以后当需要增加新的功能，LeanCloud 可以继续存储新的对象而不需要对原来的 Class 做 ALTER TABLE 操作，这会给我们的开发带来很大的便利。</p>
<h2 id="-">最佳的建模方式</h2>
<p>选择最适合的建模方式，首先要确定关系是否：</p>
<blockquote>
<p>存在附加属性？</p>
</blockquote>
<p>例如学生选课，学生在选课的时候有的从电脑浏览器里选，有的从手机上选，手机系统还区分 iOS、Android 等等。那么假设要统计一下学生选课的来源，那么建立选课关系的时候就需要记录一下附加属性，这时只有中间表可以满足这个需求。</p>
<p>其次判断：</p>
<blockquote>
<p>是一对多还是多对多？</p>
</blockquote>
<ul>
<li>一对多：Pointer </li>
<li>多对多： 中间表</li>
</ul>
<p>决定了用哪种方式之后，就按照前文介绍的一对多或多对多的实例代码构建自己的业务逻辑代码。但是 Pointer 可以实现的，中间表也可以实现，并且开发者可控的余地更多。具体可以参照如下伪代码：</p>
<pre><code>if(存在附加属性){
    return 中间表;
} else {
    switch(mode){
        case 一对多:{
            return Pointer;
        }
        case 多对多:{
            return 中间表;
        }
    }
}
</code></pre><h3 id="-">案例分析</h3>
<h4 id="-">婴儿与监护人之间的关系</h4>
<p>做一个应用统计婴儿吃饭、睡觉、玩耍的时间分布，而婴儿的监护人可能会有多个，爷爷奶奶外公外婆还有可能是月嫂。首先按照我们之前设定的思路来逐步分析应该采用哪种方式建模：</p>
<blockquote>
<p>是否存在附加属性？</p>
</blockquote>
<p>一个婴儿和一个监护人之间的关系是否有附加属性？答案是有附加属性，父子关系跟母子关系是不一样的关系，因为对于婴儿监护人的身份称呼就是这个关系的附加属性。因此不用多想，果断使用中间表。不用再纠结是一对多还是多对多。</p>
<p><img src="images/relation-guide-1.png" alt="relation-guide-1"></p>
<h4 id="-">用户与设备之间的关系</h4>
<p>婴儿的状态改变，可以通过推送服务做到实时推送给监护人，比如孩子的爸爸设备较多，他会在 iPad、iPhone 以及 Windows 上安装这个应用，那么他一般情况下会有 3 台设备。监护人在每一台设备上登录后，每当孩子的状态发生改变，服务端都会向这 3 台设备推送，那么我们接着按照之前的思路来分析应该采用哪种方式建模。</p>
<blockquote>
<p>是否存在附加属性？</p>
</blockquote>
<p>一般来说这种情况是可以省略附加属性的，因为 LeanCloud 的 <code>_Installation</code> 表里有一个字段是专门用来存储客户端设备的 deviceType，因此设备的信息是不需要存储在中间表的。
而除非有其他特殊的属性条件，设备和用户之间的关系就是一个简单的一对多的关系，并且并不需要附加属性。</p>
<p>其次判断：</p>
<blockquote>
<p>是一对多还是多对多？</p>
</blockquote>
<p>一个用户在多个设备上登录一般就可以定义为一对多，而很少会出现类似 iPhone/iPad 版 QQ 那样内置了多账户管理系统，因此定义为一对多比较满足我们现在的需求。</p>
<h3 id="-">何时使用数组</h3>
<p>当要关联的数据是简单数据并且查询多于修改的时候，用数组比较合适。比如社交类应用里给朋友加标签，就可以使用 string 数组来存储这个属性。</p>
<pre><code class="lang-objc">    AVObject *beckham= [[AVObject alloc] initWithClassName:@&quot;Boy&quot;];
    [beckham setObject: [NSArray arrayWithObjects:@&quot;颜值爆表&quot;,@&quot;明星范儿&quot;,nil] forKey:@&quot;tags&quot;];
</code></pre>
<pre><code class="lang-java">    AVObject beckham = new AVObject(&quot;Boy&quot;);
    beckham.put(&quot;tags&quot;,Arrays.asList(&quot;颜值爆表&quot;, &quot;明星范儿&quot;));
</code></pre>
<pre><code class="lang-js">    var beckham = new AV.Object(&#39;Boy&#39;);
    beckham.set(&#39;tags&#39;,[&#39;颜值爆表&#39;,&#39;明星范儿&#39;]);
</code></pre>
<pre><code class="lang-python">    beckham = leancloud.Object.create(&#39;Boy&#39;)
    beckham.set(&#39;tags&#39;, [&#39;颜值爆表&#39;, &#39;明星范儿&#39;])
</code></pre>
<pre><code class="lang-cs">    AVObject beckham = new AVObject(&quot;Boy&quot;);
    beckham.Add(&quot;tags&quot;, new string[] { &quot;颜值爆表&quot;, &quot;明星范儿&quot; });
</code></pre>


      </div>
    </div>
    <!-- .col-md-9 -->
  </div>
  <!-- .row -->

</div>
<!-- .container-fluid -->
<div id="comment-container" ng-class="{'no-comments': currentComments.length<1}">
  <div class="comment-head">
    {{allComment[version]}}
    <span class="close" ng-click="closeCommentModal()">&times;</span>
  </div>
  <div class="comment-body">
    <div class="comment-list" ng-class="{'no-login': !currentCommentUser.username}">
      <ul>
        <li ng-show="currentComments.length<1">暂无评论</li>
        <li ng-repeat="comment in currentComments">
          <div class="comment-author">{{comment.author}}</div>
          <div class="comment-timestamp">{{ comment.createdAt | date: 'yyyy-MM-dd HH:mm:ss '}}</div>
          <div class="comment-content">{{comment.content}}</div>
        </li>
      </ul>
    </div>
  </div>
  <div class="comment-compose" ng-show="currentCommentUser.username">
    <div class="form-group"> <textarea class="form-control comment-content" ng-model="commentContent"></textarea></div>
    <div class="form-meta">
      <!-- 您已登录为 <b>{{currentCommentUser.username}}</b> -->
      <button class="btn btn-sm btn-default create-comment pull-right" ng-click="createComment($event)">
        <i class="icon icon-chat-bold"></i> 评论
      </button>
    </div>
  </div>
  <div class="comment-compose no-login" ng-show="!currentCommentUser.username">
    您需要 <a class="comment-login" ng-click="loginComment()">授权</a> 后才能评论
  </div>
</div>

<script src="https://download.leancloud.cn/sdk/latest.js"></script>


<script src="custom/js/lib/contents.js"></script>
<script src="custom/js/md.js"></script>


<script type="text/javascript">
ZeroClipboard.setDefaults({
    moviePath: 'custom/js/lib/zeroclipboard/zeroclipboard.swf'
});
$(function(){
    // $('#content [version]').each(function(k,v){
    //     var version = $(v).attr('version');
    //     $(v).append('<div class="toggle-comment" ng-click="showCommentDialog(\''+version+'\''+',$event)">+ <span> {{}}</span> </div>');
    // })

    $('#content [version]').each(function(k,v){
        var version = $(v).attr('version');
        $(v).append('<div class="inline-comment-wrap" version="'+version+'" all-comment="allComment" showDialogMethod="showCommentDialog()" lc-comment> </div>');
    });

    angular.element(document).ready(function() {

      angular.bootstrap(document, ['app']);

    });
});

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42629236-7', 'auto');
  ga('send', 'pageview');

</script>





  <footer class="footer" role="contentinfo">
  <div class="container-fluid">
    <!-- <a href="http://leancloud.cn/" class="logo font-logo pull-left">
      LeanCloud
    </a> -->

    <ul class="footer-links pull-right">
      <li class="muted">·</li>
      <li><a href="/pricing">价格</a></li>
      <li class="muted">·</li>
      <li><a href="/docs/sdk_down.html">下载</a></li>
      <!-- <li class="muted">·</li>
      <li><a href="/apps.html" target="_self">App</a></li> -->
      <li class="muted">·</li>
      <li><a href="http://leancloud.cn/docs/faq.html" target="_self">常见问题</a></li>
      <li class="muted">·</li>
      <li><a href="http://leanticket.cn" target="_self"><span class="mobile-hide">技术</span>支持</a></li>
      <!-- <li><a href="http://ticket.leancloud.cn/tickets?token={{user.session_token || 'Gs5Xw4vjyCznrP6OcgMheOWDuatVpbFPiL78eMo6JC0dENB8'}}" target="_blank"><span class="mobile-hide">用户</span>反馈</a></li> -->
      <li class="muted">·</li>
      <li><a href="https://status.leancloud.cn/"><span class="mobile-hide">健康</span>状态</a></li>
      <li class="muted">·</li>
      <li><a href="http://forum.leancloud.cn/">社区</a></li>
      <li class="muted">·</li>
      <li><a href="http://blog.leancloud.cn/">Blog</a></li>
      <li class="muted">·</li>
      <li><a href="https://github.com/leancloud/docs">文档源码</a></li>
    </ul>
  </div>
</footer>



</body>

</html>
